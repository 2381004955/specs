<!DOCTYPE html>




<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  
    
    Operation
  
 | Filecoin Spec</title>



<link rel="stylesheet" href="../../book.min.23e4d1e3709b51090814a78569072de166323089d7e859dbabb823c874bdc20d.css">


<link rel="icon" href="../../favicon.png" type="image/x-icon">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  <link rel="stylesheet" href="../../css/syntax.css">
<link href="../../mermaid/mermaid.css" type="text/css" rel="stylesheet" />
<script src="../../mermaid/mermaid.js"></script>

</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav role="navigation">
<h2 class="book-brand">
  <a href="https://filecoin-project.github.io/specs/">Filecoin Spec</a>
</h2>



    
  
  
  

  <style>
  nav ul a[href$="\2f docs\2foperation\2f "] {
      color: #0b3a53;
  }
  </style>

<p><a href="../../"><strong>Overview</strong></a></p>

<p><strong>Core</strong></p>

<ul>
<li><a href="../../docs/data-structures/">Data Structures</a></li>
<li>Cryptography

<ul>
<li><a href="../../docs/address/">Address</a></li>
<li><a href="../../docs/signatures/">Signatures</a></li>
<li><a href="../../docs/proofs/">Proofs</a></li>
<li><a href="../../docs/validation/">Block Validation</a></li>
</ul></li>
<li><a href="../../docs/network-protocols/">Network</a>

<ul>
<li><a href="../../docs/bootstrap/">Bootstrapping</a></li>
<li><a href="../../docs/data-propagation/">Data Propagation</a></li>
<li><a href="../../docs/sync/">Chain Sync</a></li>
</ul></li>
<li><a href="../../docs/expected-consensus/">Expected Consensus</a></li>
<li><a href="../../docs/state-machine/">State Machine</a>

<ul>
<li><a href="../../docs/local-storage/">Local Storage</a></li>
</ul></li>
<li><a href="../../docs/operation/">Node Operation</a></li>
</ul>

<p><a href="../../docs/actors/"><strong>Actors</strong></a></p>

<ul>
<li><a href="../../docs/mining/">Mining</a></li>
<li><a href="../../docs/storage-market/">Storage Market</a></li>
<li><a href="../../docs/retrieval-market/">Retrieval Market</a></li>
<li><a href="../../docs/payments/">Payments</a></li>
<li><a href="../../docs/faults/">Faults</a></li>
</ul>

<p><strong>Proofs</strong></p>

<ul>
<li><a href="../../docs/zigzag-circuit/">ZigZag</a></li>
</ul>

<p><a href="../../docs/definitions/"><strong>Glossary</strong></a></p>

<p><strong>Spec</strong></p>

<ul>
<li><a href="../../docs/style/">Style</a></li>
<li><a href="../../docs/process/">Process</a></li>
</ul>





</nav>


  
<script>
(function() {
  var menu = document.querySelector('aside.book-menu nav')
  addEventListener('beforeunload', function(event) {
    localStorage.setItem('menu.scrollTop', menu.scrollTop)
  });
  menu.scrollTop = localStorage.getItem('menu.scrollTop')
})()
</script>



    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="../../svg/menu.svg" alt="Menu" />
  </label>
  <strong>
  
    
    Operation
  
</strong>
</header>

      
<article class="markdown">
  

<h1 id="filecoin-node-operation">Filecoin Node Operation</h1>

<p>Running a Filecoin <code>full node</code> requires running many different processes and protocols simultaneously. This section describes the set of things you need to do in order to run a fully validating Filecoin node.</p>

<div class="notices todo" ><strong>TODO</strong>: elaborate on all this, obviously</div>

<h2 id="chain-validation">Chain Validation</h2>

<p><a href="../validation">Chain validation</a> is the process by which a node stays up to date with the current state of the blockchain. This Involves:
- Listening for new blocks on the blocks pubsub channel (See <a href="data-propagation.md#block-propagation">block propagation</a>)
  - As new blocks come in, run through the block validation process
    - Keep track of valid blocks, keep track of the current &lsquo;best&rsquo; block (according to EC rules)
  - Rebroadcast valid blocks
    - Note: the actual rebroadcasting is handled by the underlying gossipsub library. We simply need to signal to that library which blocks should be rebroadcast.</p>

<h2 id="mempool-maintenance">MemPool Maintenance</h2>

<p>Listen for messages on the messages pubsub channel (See <a href="data-propagation.md#message-propagation">message propagation</a>). Validate each message, rebroadcast valid ones.</p>

<h2 id="handshaking">Handshaking</h2>

<ul>
<li>For each node you connect to, run the <a href="network-protocols.md#hello-handshake">&lsquo;hello&rsquo; protocol</a> with them

<ul>
<li>If response shows that you and the other node have different genesis blocks, disconnect from them.</li>
<li>If the other node gives a valid chain head that is farther ahead than you, &lsquo;sync&rsquo; the chain and maybe switch to it if it&rsquo;s <a href="expected-consensus.md#chain-weighing">&lsquo;heavier&rsquo;</a>.</li>
</ul></li>
</ul>

<h2 id="dht-for-peer-routing">DHT for Peer Routing</h2>

<ul>
<li>Run the DHT protocol for aiding node discovery

<ul>
<li>libp2p-kad-dht, with just &lsquo;find node&rsquo; RPCs enabled.</li>
</ul></li>
</ul>

<h2 id="bitswap-for-data-requests">Bitswap for data requests</h2>

<p>Run bitswap to fetch and serve data (such as messages) to and from other filecoin nodes. This is used to fill in missing bits during block propagation, and also to fetch data during sync.</p>

<p>There is not yet an official spec for bitswap, but <a href="https://github.com/ipfs/go-bitswap/blob/master/message/pb/message.proto">the protobufs</a> should help in the interim.</p>

<h2 id="mining">Mining</h2>

<h3 id="storage">Storage</h3>

<p>To be a Filecoin storage miner means run several processes in addition to running a &lsquo;Full Node&rsquo;.</p>

<h4 id="accept-deals">Accept Deals</h4>

<p>A Filecoin storage miner should listen for, decide upon, and accept storage deals from clients. The data being stored for each of these deals should be placed into a sector, and sealed up once that sector is full. Sealed sectors are then submitted to the chain via <code>CommitSector</code>. This logic is generally abstracted away by the &lsquo;Sector Sealing Subsystem&rsquo;.</p>

<p>To accept deals, miners should run the <a href="network-protocols.md#storage-deal">&lsquo;storage deal&rsquo;</a> service.</p>

<h4 id="prove-storage">Prove Storage</h4>

<p>Once miners have submitted sealed sectors to the chain, they will be on the hook for proving the data over time. Every <code>proving period</code>, miners should take their current <code>proving set</code> and call <code>post.GeneratePost</code> on it. This process will take a fairly long amount of time (TODO: either put specific parameters here, or link to them) and result in a compact Proof of SpaceTime, which must then be submitted to the chain via <code>SubmitPoSt</code></p>

<h4 id="extend-the-blockchain">Extend the Blockchain</h4>

<p>A storage miner is also responsible for producing blocks to extend the blockchain. At every round, storage miners check to see if they are the leader, and if they are, they submit a new block to the network, earning a reward for doing so.</p>

<p>The responsibilities of storage miners are documented in more detail in the <a href="../mining">mining document</a></p>

<h3 id="retrieval">Retrieval</h3>

<p>To be a filecoin retrieval miner: (todo)</p>

</article>

      
<div class="align-center book-git-footer justify-between">
  
  <div>
    
    <a href="https://github.com/filecoin-project/specs/commit/9dcf16da57ae5577304bbf442808d35563add0aa" title='Last modified May 11, 2019 by dignifiedquire' target="_blank" rel="noopener">
      <img src="../../svg/code-merge.svg" alt="Changed" /> May 11, 2019
    </a>
  </div>
  
  
  <div>
    <a href="https://github.com/filecoin-project/specs/edit/master/operation.md" target="_blank" rel="noopener">
      <img src="../../svg/code-fork.svg" alt="Edit" /> Edit this page
    </a>
  </div>
  
</div>


      
    </div>

    
  
  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#filecoin-node-operation">Filecoin Node Operation</a>
<ul>
<li><a href="#chain-validation">Chain Validation</a></li>
<li><a href="#mempool-maintenance">MemPool Maintenance</a></li>
<li><a href="#handshaking">Handshaking</a></li>
<li><a href="#dht-for-peer-routing">DHT for Peer Routing</a></li>
<li><a href="#bitswap-for-data-requests">Bitswap for data requests</a></li>
<li><a href="#mining">Mining</a>
<ul>
<li><a href="#storage">Storage</a>
<ul>
<li><a href="#accept-deals">Accept Deals</a></li>
<li><a href="#prove-storage">Prove Storage</a></li>
<li><a href="#extend-the-blockchain">Extend the Blockchain</a></li>
</ul></li>
<li><a href="#retrieval">Retrieval</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>
  
  
  
</body>

</html>
